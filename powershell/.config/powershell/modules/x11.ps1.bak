### X11 ###

# choco install -y VcXsrv
# choco install -y xming

# Must be before 'Match Group administrators'!
# Add-Content -Path "C:\ProgramData\ssh\sshd_config" -Value "X11Forwarding yes"
# Add-Content -Path "C:\ProgramData\ssh\sshd_config" -Value "X11DisplayOffset 10"
# Add-Content -Path "C:\ProgramData\ssh\sshd_config" -Value "X11UseLocalhost no"
# Add-Content -Path "C:\ProgramData\ssh\sshd_config" -Value 'XAuthLocation "C:/Program Files/VcXsrv/xauth.exe"'

# $env:DISPLAY = "10.211.55.2:0"
# $env:DISPLAY= "127.0.0.1:0.0"
$vcxsrvPath = "C:\Program Files\VcXsrv"
[Environment]::SetEnvironmentVariable("Path", $env:Path + ";$vcxsrvPath", [EnvironmentVariableTarget]::Machine)
$env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path","User")

# on Windows: Start "XLaunch"
# on macOS: $ xhost + 10.211.55.3
if (Get-Command Get-NetRoute -ErrorAction SilentlyContinue) {
    $macIP = (Get-NetRoute -DestinationPrefix "0.0.0.0/0").NextHop | Select-Object -First 1
    $env:DISPLAY = "${macIP}:0"
}
###########