#!/usr/bin/env python3
import sys
import urllib.parse
import subprocess
import os

WINDOWS_PREFIX = 'K:\\Daten'
MAC_PREFIX = f'{os.path.expanduser("~")}/Daten'

def main():
    if len(sys.argv) != 2:
        print("Usage: winpath2mac 'K:\\Daten\\path\\to\\file.docx'")
        sys.exit(1)

    windows_path = sys.argv[1]

    if not windows_path.startswith(WINDOWS_PREFIX):
        print(f"Error: Path must start with {WINDOWS_PREFIX}")
        sys.exit(1)

    mac_path = windows_path.replace(WINDOWS_PREFIX, MAC_PREFIX, 1)
    mac_path = mac_path.replace('\\', '/')
    file_url = 'file://' + urllib.parse.quote(mac_path)

    subprocess.run(['pbcopy'], input=file_url, text=True)
    print(file_url)

    response = input("Open file? (Y/n): ").strip().lower()
    if response == "" or response == "y":
        subprocess.run(['open', mac_path])

if __name__ == '__main__':
    main()
