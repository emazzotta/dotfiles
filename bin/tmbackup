#!/bin/bash

echo "Creating backup of tm database"

kubectl exec -i deployment.apps/teslamate-mazzotta-db-deployment -- /bin/sh -c "pg_dump -U ${TM_USER} -d ${TM_USER}" > "${WDIR}/private/infrastructure/pending/teslamate/backup/$(date +%Y-%m-%dT%H-%M-%S).sql"

echo 
echo "Contents of ${WDIR}/private/infrastructure/pending/teslamate/backup:"
bash -lci "ls -l ${WDIR}/private/infrastructure/pending/teslamate/backup"

