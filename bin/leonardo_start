#!/bin/bash

leonardo_account

leonardo_vpn_toggle --connect-only
HOST="devserver.leonardo.local"
MAX_TRIES=10

check_host() {
    ping -c 1 $HOST > /dev/null 2>&1
    return $?
}

for (( i=0; i<$MAX_TRIES; i++ )); do
    echo "Checking if $HOST is reachable, attempt $((i+1))..."
    if check_host; then
        echo "$HOST is reachable."
        leonardo_kerberos
        leonardo_drive
        exit 0
    fi
    sleep 1
done

echo "$HOST is not reachable after $MAX_TRIES attempts."
exit 1
