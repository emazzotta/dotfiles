#!/usr/bin/env python3
import socket
import sys
from typing import Final

HOSTS: Final[dict[str, tuple[str, ...]]] = {
    "ci-macmini": ("ci-macmini.machines.leonardo.local", "Mac-mini-von-Andreas.local", "192.168.5.28"),
}


def resolve(short_name: str) -> str:
    if short_name not in HOSTS:
        print(f"Unknown host: {short_name}", file=sys.stderr)
        sys.exit(1)

    entry = HOSTS[short_name]
    dns_hostnames, fallback_ip = entry[:-1], entry[-1]

    for hostname in dns_hostnames:
        try:
            return socket.gethostbyname(hostname)
        except socket.gaierror:
            continue

    return fallback_ip


def main() -> None:
    if len(sys.argv) != 2:
        print(f"Usage: {sys.argv[0]} <host-short-name>", file=sys.stderr)
        sys.exit(1)

    print(resolve(sys.argv[1]))


if __name__ == "__main__":
    main()
