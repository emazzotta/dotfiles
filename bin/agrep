#!/bin/bash

FILE="${HOME}/.bashrc"
EXACT_FLAG="-iF"

if [[ $# -eq 0 ]]; then
    echo "usage: $(basename "$0") [-e|--exact] <term>"
    exit 1
fi

if [[ "$1" == "-e" || "$1" == "--exact" ]]; then
    EXACT_FLAG="-iFw"
    TERM="${2:-}"
else
    TERM="$1"
fi

[[ -z "$TERM" ]] && echo "Error: search term required" && exit 1

search_in_bashrc() {
    local prefix=$1
    grep -w "$prefix" "$FILE" | awk -v p="$prefix" '{$1=p; print}' | grep $EXACT_FLAG "$TERM"
}

search_in_custom_bin() {
    ls "${CUSTOM_BIN_DIR}" 2>/dev/null | while read -r filename; do
        local filepath="${CUSTOM_BIN_DIR}/${filename}"
        [[ ! -f "$filepath" ]] && continue
        if cat "$filepath" | grep -q $EXACT_FLAG "$TERM"; then
            cat "$filepath" | grep $EXACT_FLAG "$TERM" | while read -r line; do
                echo -e "${line} ${COLOR_RED}(${filename})${COLOR_RESET}"
            done
        fi
    done
}

if ! ls "${CUSTOM_BIN_DIR}" 2>/dev/null | grep -qw "$TERM"; then
    search_in_bashrc "export"
    search_in_bashrc "alias"
    search_in_custom_bin
else
    FULL_PATH="${CUSTOM_BIN_DIR}/${TERM}"

    if [[ "$EXACT_FLAG" == "-iF" ]] && ls "${FULL_PATH}"* &>/dev/null; then
        cat "${FULL_PATH}"*
    elif [[ -e "$FULL_PATH" ]]; then
        cat "$FULL_PATH"
    fi
fi
