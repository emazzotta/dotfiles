#!/bin/bash

VM_STAT_DATA=$(vm_stat)

function extract_value_by_key() {
    bc -l <<< "scale=2; $(echo "$VM_STAT_DATA" | grep -i "${1}" | awk '{ print $NF  }' | sed 's/\.//')*4096/1024/1024"
}

ANONYMOUS_BLOCKS=$(extract_value_by_key "anonymous")
PURGEABLE_BLOCKS=$(extract_value_by_key "purgeable")
COMPRESSED_BLOCKS=$(extract_value_by_key "occupied by compressor")
WIRED_BLOCKS=$(extract_value_by_key "wired")

TOTAL=$(($(sysctl hw.memsize | awk '{print $2}')/1024/1024))
TOTAL_GB=$(echo "scale=2; $TOTAL/1024" | bc -l)

USED=$(echo "scale=2; $ANONYMOUS_BLOCKS-$PURGEABLE_BLOCKS+$COMPRESSED_BLOCKS+$WIRED_BLOCKS" | bc -l)
USED_GB=$(echo "scale=2; $USED/1024" | bc -l)

echo "${USED_GB}G/${TOTAL_GB}G"

# vm_stat | grep pages | awk '{print $NF}' | xargs -I {} echo {} | sed 's/\.//' | xargs -I {} echo "scale=2; {}*4096/1024/1024/1024" | bc -l | xargs -I {} echo {} GB
