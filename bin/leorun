#!/bin/bash
set -e

SKIP_COMPILE=false
if [ "$1" == "--fast" ] || [ "$1" == "-f" ]; then
    SKIP_COMPILE=true
fi

export LEONARDO_PROJECTS="$HOME/Projects/leo-productions"
export JAVA_LIBRARY_PATH="$LEONARDO_PROJECTS/leonardo/leonardo-leonardo/target/natives.mac"
LEONARDO_DIR="$LEONARDO_PROJECTS/leonardo"
RESOURCES_DIR="$LEONARDO_PROJECTS/leonardo/leonardo-resources"
MAIN_CLASS="ifactory.leonardo.model.LeonardoApplication"
change_dir() {
    echo "üìÅ Changing to: $1"
    cd "$1"
}
echo "üöÄ Starting Leonardo build and run..."
echo "üìÇ Work directory: $LEONARDO_PROJECTS"
echo "üîó JAVA_LIBRARY_PATH=$JAVA_LIBRARY_PATH"
echo "‚òï Main class: $MAIN_CLASS"
echo ""

if [ "$SKIP_COMPILE" = false ]; then
    echo "üî® Building Leonardo..."
    change_dir "$LEONARDO_DIR"
    mvn clean compile -DskipTests
else
    echo "‚ö° Skipping compilation (fast mode)"
    change_dir "$LEONARDO_DIR"
fi

echo "‚ñ∂Ô∏è  Starting Leonardo application..."
change_dir "$RESOURCES_DIR"
mvn -f "$LEONARDO_DIR/pom.xml" exec:java -pl leonardo-leonardo -Dexec.mainClass="$MAIN_CLASS" -Dlog4j2.rootLevel=INFO
