#!/bin/bash
set -euo pipefail

export LEONARDO_PROJECTS="$HOME/Projects/leo-productions"
LEONARDO_DIR="$LEONARDO_PROJECTS/leonardo"

[ ! -f "$LEONARDO_DIR/ops/maven_settings.xml" ] && [ ! -f "$LEONARDO_DIR/pom.xml" ] && {
    echo "Error: Not in leonardo project root (missing ops/maven_settings.xml or pom.xml)" >&2
    exit 1
}

cd "$LEONARDO_DIR"
echo "üìÅ Running from: $LEONARDO_DIR"

MVN_COMMON_FLAGS="-Prun-leonardo -s ops/maven_settings.xml -pl leonardo-leonardo"

MODE="normal"
[ "${1:-}" = "-f" ] || [ "${1:-}" = "--fast" ] && MODE="fast"
[ "${1:-}" = "-q" ] || [ "${1:-}" = "--quick" ] && MODE="quick"

case "$MODE" in
  fast)
    CMD="mvn exec:exec $MVN_COMMON_FLAGS"
    ;;
  quick)
    CMD="mvn compile exec:exec $MVN_COMMON_FLAGS"
    ;;
  *)
    CMD="mvn clean compile exec:exec $MVN_COMMON_FLAGS"
    ;;
esac

echo "‚û§ $CMD"
$CMD
